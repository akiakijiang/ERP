<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>申报系统交易信息导入</title>
	<link rel="stylesheet" type="text/css" href="js/style/calendar/GooCalendar.css"/>
	<link rel="stylesheet" href="js/style/zapatec/zpcal/themes/winter.css" />
	<link rel="stylesheet" type="text/css" href="styles/goodschange.css">
	<script type="text/javascript" src="misc/jquery.js"></script>
	<script type="text/javascript" src="misc/ajaxfileupload.js"></script>
    <script type="text/javascript" src="misc/jquery.ajaxQueue.js"></script>
	
    
 
 	<script type="text/javascript" src="js/json2.js"></script>
	<script type="text/javascript" src="js/v3.js"></script>
	<script type="text/javascript" src="js/style/zapatec/utils/zapatec.js"></script>
	<script type="text/javascript" src="js/style/zapatec/zpcal/src/calendar.js"></script>
	<script type="text/javascript" src="js/style/zapatec/zpcal/lang/calendar-en.js"></script>
	<style type="text/css">
	{literal}
	body{
		font-size: 14px;
	}
	table{
		font-size: 13px;
		width: 97%;
		margin:0px auto
	}
	table th,table td{
	    font-weight: normal;
	    text-align: center;
	    border:1px solid #62B4E8;
	}
	table td{
	    padding:6px 0;
	}

	table th{
	    padding:10px 0;
	    background: #62B4E8;
	    color:#fff;
	}
	h1{
		font-size: 1.5em;
		color:#333;
		text-align: center;
		margin:10px 0;
	}
	.submit{
				border:none;
				outline: none;
			    background: #60b7e1;
			    border-radius: 2px;
			    -o-border-radius: 2px;
			    padding: 2px 2px !important;
			    color: #fff !important;
			    width: 80px;
			    height:30px;
			    cursor: pointer;
			    position: relative;
			    margin: 2px auto;
	}
	.simpEditBtn{
		width: auto;
		margin:3px;
	}
	
	.button:hover { 
	                background: #3da1d1;
	                transition:all .2s;
	                -o-transition:all .2s;
	                }
	                
	.button:active {
	                position: relative;
	                top:1px;
	                }
	input[type="text"]{
                display: inline-block;
                height: 28px;
                line-height: 32px;
                color: #333;
                border-radius: 3px;
                -o-border-radius: 3px;
                border:1px solid #b1b1b1;
                outline: none; /* for chorme & safari's default effect */
                margin: 0 5;
            }
    .msg{
        width: 80%;
    	padding:5px 0 5px 40px;
    	margin:10px auto;
    	display: none;
    	
    }
    .msg-success{
    	background: url('img/tick_circle.png') #d5ffce no-repeat;
    	background-position: 10px center;
        border-color: #9adf8f;
        color: #556652;
        
    }
    .msg-error{
    	background: url('img/cross_circle.png') #ffcece no-repeat;
    	background-position: 10px center;
        border-color: #df8f8f;
        color: #665252;
    }
    .redtr{
    	background-color: #ffcece;
    }
    .importantNote{
        color:red;
        font-size:18px;
    }
    .modify {
	  width: 250px;
	  height: 150px;
	  text-align: center;
		background-color:#DDD;
		width:300px;
		margin-left: auto;
		margin-right: auto;
		border: 1px solid grey;
		padding: 10px;
		position:absolute;
		top: 40%;
  		left: 40%;
	}
	.import {
		  margin-right: 23px;
		}
	.attention{
	color: red;
	}
    {/literal}
	</style>
	<script type="text/javascript">
	var WEB_ROOT = '{$WEB_ROOT}';
	{literal}
		function check_form(){
			$('#upload_btn').attr('disabled',true);
			return true;
		}
		{/literal}
	</script>
</head>

<body>
<fieldset style="border:rgba(220,220,220,.8) 2px solid;"><legend class="expand" style="font-size: 15px;background-color: #B8DCFF";>&nbsp;申报系统交易信息导入&nbsp;</legend><br />	
{if $platform == "360buy"}
	<div style="margin-left: 20px; width:750px;" align="left">
	<div class="tab-title">
          <div><a class="selected" style="text-decoration:none;color:black;font-size:20px" href="payInfoImport.php?platform=360buy">京东平台</a></div>
          <div ><a class="item" href="payInfoImport.php?platform=miya">蜜芽平台</a></div>
          <div ><a class="item" href="payInfoImport.php?platform=fenxiao">申报系统分销订单</a></div>
        </div>
        {if $message}
		<div id="message" style="border:rgba(220,220,220,.8) 2px solid; padding:5px; text-align:center;" >
          {$message}
        </div>
        {/if}
     </div>
        <div class="import">
			<form id="upload" method="post" enctype="multipart/form-data" action="payInfoImport.php?platform=360buy" align="right" onsubmit="return check_form()">
		      <input type="file" name="excel" size="20" />
		      <input type="submit" id='upload_btn' value="导入" />
		      <input type="hidden" name="act" value="upload" />
		      <input type="hidden" name="platform" value="360buy" />
		    </form>
		</div>
	{/if}
	
	{if $platform == "miya"}
	<div style="margin-left: 20px; width:750px;" align="left">
	<div class="tab-title">
          <div><a class="item"  href="payInfoImport.php?platform=360buy">京东平台</a></div>
          <div ><a class="selected" style="text-decoration:none;color:black;font-size:20px" href="payInfoImport.php?platform=miya">蜜芽平台</a></div>
          <div ><a class="item" href="payInfoImport.php?platform=fenxiao">申报系统分销订单</a></div>
        </div>
        {if $message}
		<div id="message" style="border:rgba(220,220,220,.8) 2px solid; padding:5px; text-align:center;">
          {$message}
        </div>
        {/if}
     </div>
        <div class="import">
			<form id="upload" method="post" enctype="multipart/form-data" action="payInfoImport.php?platform=miya" align="right" onsubmit="return check_form()">
		      <input type="file" name="excel" size="20" />
		      <input type="submit" id='upload_btn' value="导入" />
		      <input type="hidden" name="act" value="upload" />
		      <input type="hidden" name="platform" value="miya" />
		    </form>
	    </div>
	
	{/if}
	
	{if $platform == "fenxiao"}
	<div style="margin-left: 20px; width:750px;" align="left">
	<div class="tab-title">
          <div><a class="item"  href="payInfoImport.php?platform=360buy">京东平台</a></div>
          <div ><a class="item" href="payInfoImport.php?platform=miya">蜜芽平台</a></div>
          <div ><a class="selected" style="text-decoration:none;color:black;font-size:20px" href="payInfoImport.php?platform=fenxiao">申报系统分销订单</a></div>
        </div>
        <div class="attention">
        注意：分销订单的支付类型为支付方式编号，如02,08...
        </div>
        {if $message}
		<div id="message" style="border:rgba(220,220,220,.8) 2px solid; padding:5px; text-align:center;">
          {$message}
        </div>
        {/if}
     </div>
        <div class="import">
			<form id="upload" method="post" enctype="multipart/form-data" action="payInfoImport.php?platform=fenxiao" align="right" onsubmit="return check_form()">
		      <input type="file" name="excel" size="20" />
		      <input type="submit" id='upload_btn' value="导入" />
		      <input type="hidden" name="act" value="upload" />
		      <input type="hidden" name="platform" value="fenxiao" />
		    </form>
	    </div> 
	
	{/if}
	<!-- 
		<div id="modify" class="modify" style="display:none">
			 分销商店铺：{$smarty.request.appkey}
			    <br/>
			  外部订单号：
			    <input style="width:80px" name="taobaoordersn" value=""/>
			    <br/>
			  支付类型：
			    <input style="width:80px" name="paytype" value="{$smarty.request.paytype}"/>
			    <br/>
			   交易流水号：
			    <input style="width:80px" name="paynumber" value="{$smarty.request.paynumber}"/>
			    <br/>
			 	<button onclick="boxajax()">提交</button>
                <button onclick="boxhidden()" style="margin-left:10px">取消</button>
			 <input type="hidden" name="act" value="search">
		</div>
	 -->
	<form>
		<table border="0">
		<tr><td>
		 分销商店铺：
		    <input id="appkey" style="width:80px" size="50" name="appkey" value="{$smarty.request.appkey}">&nbsp;
		  外部订单号：
		    <input style="width:80px" name="taobao_order_sn" value="{$smarty.request.taobao_order_sn}">&nbsp;
		
		 <span style="width:110px">查询起始时间：
		 <input style="width:100px;height:20px" id="start_time" name="start_time" value="{$result.startCalendar}"></span>
		 <span style="margin-top:13px;width:20px"><input type="button" style="background-image:url(images/image/date.gif);width:15px;border:0px;height:16px;" id="startTrigger" /></span>
		
		 <span style="width:110px">查询结束时间：
		 <input style="width:100px;height:20px" id="end_time" name="end_time" value="{$smarty.request.end_time}"></span>
		<span style="margin-top:13px;width:20px"><input type="button" style="background-image:url(images/image/date.gif);width:15px;border:0px;height:16px;" id="endTrigger" /></span>
		
		 <input type="submit" class="submit" value="搜索" style='font-size:10px'>&nbsp;
		 <input type="hidden" name="act" value="search">
		 <input type="hidden" name="platform" value="{$platform}">
		 </td>
		 
		 <td><div>
		    <div style="float: right; margin-right: 100px;">
		    <form method="post" enctype="multipart/form-data" action="download_model.php?act=download_model_order">
		        <div style='color:red'>模板已更新，请下载后解压</div>
		    	<!-- <input type="submit" value="批量导入模板下载"/> -->
		    	<a href="payInfoImport.rar">批量导入模板下载</a>
		    </form>
		    </div>
		</div></td></tr>
		 
		 </table>
		 
		 
    </form>
	
	 
	
	<form action="payInfoImport.php" method="post">
		<table>
			<thead>
				<tr>
					<th>平台</th>
					<th>分销商店铺</th>
					<th>外部订单号</th>
					<th>支付类型</th>
					<th>支付流水号</th>
					<th>最后更新时间</th>
					<th>操作</th>
				</tr>
			</thead>
			{foreach from=$order_list key=k item=order}
			<tr>
				
				<td name="platform" class="platform">{$platform}</td>
				
				<td>{$order.nick}</td>
				<td name="taobao_order_sn" class="taobao_order_sn">{$order.taobao_order_sn}</td>
				<td><input type="text" name="pay_type[]" class="pay_type" value="{$order.pay_type}" /></td>
				<td><input type="text" name="pay_number[]" class="pay_number" value="{$order.pay_number}" /></td>
				<td>{$order.last_updated_stamp}</td>
				
				<td>
					<input type="button"  value="修改" class="button simpEditBtn">
				</td>
			</tr>
			{/foreach}
			<tr>
				<td colspan="11" style="text-align:right;padding-right:20px;">{$Pager}</td>
			</tr>
		</table>
	</form>
	
	<script>
// <![CDATA[
//{literal}
		$(document).ready(function(){			
				var simpEditBtn = $(".simpEditBtn");
				simpEditBtn.click(function(){
					var that = $(this);
					var simp_taobao_order_sn = that.parent().parent().find(".taobao_order_sn").text();
					var simp_pay_type = that.parent().parent().find(".pay_type").val();
					var simp_pay_number = that.parent().parent().find(".pay_number").val();
					var simp_platform = that.parent().parent().find(".platform").text();
					
					var data = "taobao_order_sn=" + simp_taobao_order_sn + "&pay_type=" + simp_pay_type +"&pay_number="+simp_pay_number+"&platform="+simp_platform;
					if( simp_taobao_order_sn == "" ){
						alert("数据不能为空~");
					}else{
						$.ajax({
							type:'post',
							dataType:'json',
							data:data,
							url:'ajax.php?act=update_pay_info',
							success:function(data){
								alert("修改成功");
								//window.location.href ='payInfoImport.php';
							},
							error:function(data){
								console.log(data);
								alert("修改失败");
							}
						});
					}
				});
				
				
				
			});
		//{/literal}
		// ]]>
		</script>
</fieldset>


<script type="text/javascript">
// <![CDATA[
// {literal}
Zapatec.Calendar.setup({
	weekNumbers       : false,
	electric          : false,
	inputField        : "start_time",
	button            : "startTrigger",
	ifFormat          : "%Y-%m-%d",
	daFormat          : "%Y-%m-%d"
});
Zapatec.Calendar.setup({
	weekNumbers       : false,
	electric          : false,
	inputField        : "end_time",
	button            : "endTrigger",
	ifFormat          : "%Y-%m-%d",
	daFormat          : "%Y-%m-%d"
});




// {/literal}
// ]]>
</script>
</body>


</html>
